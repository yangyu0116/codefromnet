<?
#
# Author: Marco(hkfuk)
#
# Contact: [email]Crazy_Marco@msn.com[/email]
#
$host="localhost";//mysql的host
$user="root";//mysql的用裘Q
$pw="";//mysql的密a
$db="";//mysqlY料烀Q
$update_time="30";//更新的l率---秒数
session_start();
if(!$_SESSION['name'])session_register("name");
############################################
$con=mysql_connect($host,$user,$pw)or die("不可以B接Y料");
$now=time();
mysql_select_db($db,$con)or die("e`的Y料$db");
if(!empty($name)){//如果用粢呀登入了
$query=mysql_query("select count(username) from online_list where username='$name'",$con);//查在到表是否已有用舻拿Q
$result=mysql_result($query,0);//查的Y果
if($result!=0){//如果用粢呀在在列表了
@mysql_query("update online_list set second_time='$now' where username='$name'",$con);//更新用舻淖钺嵩诰rg
}else{//如果用粢呀不在在列表
@mysql_query("insert into online_list(username,userip,online_time,second_time)values('$name','$REMOTE_ADDR','$now','$now')",$con);//新增一用舻皆诰列表
}
}

else{//如果用]有登入
$query=mysql_query("select count(userip) from online_list where userip='$REMOTE_ADDR'",$con);//查在到表是否已有L客的ip 地址
$result=mysql_result($query,0);//查的Y果
if($result!=0){//如果L客的ip地址已在在列表了
@mysql_query("update online_list set second_time='$now' where userip='$REMOTE_ADDR'",$con);//更新L客的最後在rg
}else{//如果用袅斜]有L客的ip地址
@mysql_query("insert into online_list(username,userip,online_time,second_time)values('L客','$REMOTE_ADDR','$now','$now')",$con);//新增一L客到在列表
}
}
$del_time=$now-$update_time;
@mysql_query("delete from online_list where second_time<$del_time",$con);//h除在$update_time秒]有幼鞯挠
?>